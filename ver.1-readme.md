---

# 물류센터 거래데이터 – 통합 보강본 안내

본 문서는 데이터 분석을 시작하는 팀원을 위한 안내입니다.
분석에는 \*\*아래 4개 파일(\_보강)\*\*만 사용하세요.

* `A센터_매입_통합_보강.csv`
* `A센터_매출_통합_보강.csv`
* `B센터_매입_통합_보강.csv`
* `B센터_매출_통합_보강.csv`

## 1) 정리·보강 내용 요약

* **스키마 통일**: 센터별, 매입/매출별로 컬럼 체계를 표준화.
* **형식 정리**

  * 날짜: 엑셀 일련번호/문자열 → 날짜형 변환.
  * 숫자: 쉼표 제거 후 숫자형(`판매수량/입수/공급가액/판매금액/부가세/EA` 등).
  * 코드/텍스트: `매출처코드/옵션코드/상품코드/바코드/규격/카테고리` 등 문자열 고정.
  * 우편번호: 숫자만 남기고 `0/00000/000000` 등은 결측 처리.
* **결측 보강(원본 값은 덮어쓰지 않음)**

  * `(센터, 매출처코드) → 매출처 우편번호`를 **최빈값**으로 보강.
  * `바코드 → (대분류/중분류/소분류)`를 **최빈값**으로 보강.

    * 동률이면 사전순으로 1개를 선택(결정 규칙 고정).
* **메타 컬럼 유지**: `원본파일`, `센터`, `유형`(매입/매출) 포함 → 행 출처 추적 가능.
* **중요**: **매출처 ‘이름’ 컬럼은 없음.** 점포 식별은 `매출처코드(+우편번호)`로 수행.

---

## 2) 주요 컬럼(스키마)

### 2.1 매입(purchase)

| 컬럼          | 설명                          |
| ----------- | --------------------------- |
| 작업유형        | 입고/반품 등 작업 유형               |
| 일자          | 입고일                         |
| 매출처코드       | 점포/거래처 코드(매입에서는 비어 있을 수 있음) |
| 매출처 우편번호    | 점포 우편번호(최빈값 보강 적용)          |
| 공급업체 코드     | 공급사(매입처) 코드                 |
| 공급업체 우편번호   | 공급사 우편번호                    |
| 입고 형태       | 직납/제3자 등                    |
| 상품코드        | 내부 상품 코드                    |
| 바코드         | 상품 바코드                      |
| 상품명         | 상품명                         |
| 규격          | 규격(용량/사이즈 등)                |
| 옵션 코드       | 옵션 코드(판매 단위 등)              |
| 옵션          | 옵션 원문 값(EA/BOX/벌/낱개…)       |
| 입수          | 1BOX당 EA 수                  |
| 수량          | 원본 입고 수량                    |
| EA          | EA 기준 수량                    |
| 판매금액        | 매입 금액(원본 ‘판매금액’)            |
| 부가세         | 매입 부가세(‘부가세(과세)’ 포함 통일)     |
| 대분류/중분류/소분류 | 상품 카테고리(바코드 최빈값으로 보강)       |
| 원본파일/센터/유형  | 메타데이터                       |

### 2.2 매출(sales)

| 컬럼          | 설명                    |
| ----------- | --------------------- |
| 판매일         | 판매일(결측 허용)            |
| 구분          | 판매/반품 등(결측 허용)        |
| 매출처코드       | 점포/거래처 코드             |
| 매출처 우편번호    | 점포 우편번호(최빈값 보강 적용)    |
| 판매수량        | 원본 판매 수량              |
| 옵션코드        | 옵션 코드(판매 단위 등)        |
| 규격          | 규격                    |
| 입수          | 1BOX당 EA 수            |
| 바코드         | 상품 바코드                |
| 상품명         | 상품명                   |
| 대분류/중분류/소분류 | 상품 카테고리(바코드 최빈값으로 보강) |
| 공급가액        | 매출 공급가액(판매금액 없음)      |
| 부가세         | 매출 부가세                |
| 원본파일/센터/유형  | 메타데이터                 |

---

## 3) 로딩 가이드(파이썬)

```python
import pandas as pd
from pathlib import Path

OUT_DIR = Path("/00_Sookmyunguniv/DACOS(2025)/데이터톤/데이터 분석/2025 숙명여대_물류센터 거래데이터_KEA/_out")

# 공통 문자열 dtype (혼합 타입 경고 방지)
dtype_common = {
    "매출처코드":"string", "매출처 우편번호":"string",
    "바코드":"string", "상품명":"string", "규격":"string",
    "대분류":"string", "중분류":"string", "소분류":"string",
    "원본파일":"string", "센터":"string", "유형":"string",
}

# 매출
sales_A = pd.read_csv(OUT_DIR/"A센터_매출_통합_보강.csv",
                      dtype={**dtype_common, "옵션코드":"string"},
                      parse_dates=["판매일"])
sales_B = pd.read_csv(OUT_DIR/"B센터_매출_통합_보강.csv",
                      dtype={**dtype_common, "옵션코드":"string"},
                      parse_dates=["판매일"])
sales = pd.concat([sales_A, sales_B], ignore_index=True)

# 매입
purch_A = pd.read_csv(OUT_DIR/"A센터_매입_통합_보강.csv",
                      dtype={**dtype_common, "상품코드":"string","옵션 코드":"string","옵션":"string"},
                      parse_dates=["일자"])
purch_B = pd.read_csv(OUT_DIR/"B센터_매입_통합_보강.csv",
                      dtype={**dtype_common, "상품코드":"string","옵션 코드":"string","옵션":"string"},
                      parse_dates=["일자"])
purchase = pd.concat([purch_A, purch_B], ignore_index=True)

print(sales.shape, purchase.shape)
```

---

## 4) 빠른 품질 체크(권장)

```python
def miss(df):  # 결측률 요약
    cols = [c for c in ["매출처코드","매출처 우편번호","대분류","중분류","소분류"] if c in df.columns]
    return df[cols].isna().mean().round(3)

print("[매출] 결측률:\n", miss(sales))
print("[매입] 결측률:\n", miss(purchase))

# 우편번호 플레이스홀더가 남았는지 확인
for name, df in [("매출", sales), ("매입", purchase)]:
    bad = df["매출처 우편번호"].dropna().isin(["0","00000","000000"]).sum()
    print(f"[{name}] 이상 우편번호 개수:", bad)

# 금액 음수/이상치 확인
print("매출 공급가액<0 건수:", (sales["공급가액"] < 0).sum())
print("매입 판매금액<0 건수:", (purchase["판매금액"] < 0).sum())
```

---

## 5) 분석 시 유의사항

* **점포 이름 없음**: 점포 식별은 `매출처코드(±매출처 우편번호)`로 수행하세요.
* **매입의 점포 정보**는 설계상 비어 있는 행이 많습니다(센터↔공급사 입고 중심).
* **보강 규칙**: 원본 값이 존재하면 **절대 덮어쓰지 않음**. 비어 있는 값만 채움.
* **바코드/카테고리 충돌**이 빈번한 항목은 소수 존재할 수 있습니다. 본 분석에서는 최빈값으로 수렴시켰습니다. 민감 분석이 필요하면 해당 바코드를 별도 필터링하여 검토하세요.

---

## 6) 추천 키/조인

* 점포 축 집계: `센터, 매출처코드(, 매출처 우편번호)`
* 상품 축 집계: `바코드` (필요 시 `상품명/규격` 보조)
* 기간 축: `판매일`(매출), `일자`(매입)

---

## 7) 변경 이력(간단)

* v1: 원본 6개 엑셀 → 스키마 통일 → 4개 `*_통합.csv` 생성
* v1.1: 후처리 보강 적용 → 4개 `*_통합_보강.csv` 생성

  * 우편번호/카테고리 최빈값 보강, 문자열/숫자/날짜 정리 강화

---
